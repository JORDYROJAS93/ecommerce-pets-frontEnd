<div class="container mt-4">
  <button class="btn btn-success mb-3" (click)="goBack()">
    ← Volver a productos
  </button>

  @if (loading) {
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
  } @else if (producto) {
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h2 class="mb-0">{{ producto.nombre }}</h2>
        <p class="mb-0 opacity-75">{{ producto.sku }}</p>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-8">
            <p>
              <strong>Descripción corta:</strong> {{ producto.descripcionCorta }}
            </p>
            <p><strong>Descripción:</strong> {{ producto.descripcion }}</p>
            
            <div class="row mt-3">
              <div class="col-sm-6">
                <p><strong>Precio:</strong> {{ producto.precio | currency : "PEN " : "symbol" }}</p>
              </div>
              <div class="col-sm-6">
                <p><strong>Peso:</strong> {{ producto.pesoGramos }} gr</p>
              </div>
            </div>

            <p>
              <strong>Estado:</strong>
              <span [class.text-success]="producto.estaActivo" [class.text-danger]="!producto.estaActivo">
                {{ producto.estaActivo ? "Activo" : "Inactivo" }}
              </span>
            </p>

            <!-- Etiquetas dietéticas -->
            <div class="mt-3">
              <h5>Etiquetas dietéticas:</h5>
              @if (dietaryTags.length > 0) {
                <div>
                  @for (tag of dietaryTags; track tag.id) {
                    <span class="badge bg-primary me-1">{{ tag.nombre }}</span> <!-- ✅ ¡Corregido a 'nombre'! -->
                  }
                </div>
              } @else {
                <p class="text-muted">No tiene etiquetas asignadas.</p>
              }
            </div>

            <!-- Información adicional -->
            @if (producto.marca) {
              <p><strong>Marca:</strong> {{ producto.marca.nombre }}</p>
            }
            @if (producto.categoria) {
              <p><strong>Categoría:</strong> {{ producto.categoria.nombre }}</p>
            }
            @if (producto.stock) {
              <p><strong>Stock Disponible :</strong> {{ producto.stock }} unidades</p>
            }
            @if (producto.mascota) {
              <p><strong>Para:</strong> {{ producto.mascota.especie }}</p>
            }@else {
              <p class="text-muted">No especifica mascota objetivo.</p>
            }

          </div>
          
          <!-- Imágenes (si las tienes) -->
          <div class="col-md-4">
            @if (producto.imagenes && producto.imagenes.length > 0) {
              <img [src]="producto.imagenes[0].url" class="img-fluid rounded" alt="{{ producto.nombre }}">
            } @else {
              <div class="bg-light border rounded d-flex align-items-center justify-content-center" style="height: 200px;">
                <span class="text-muted">Sin imagen</span>
              </div>
            }
          </div>
        </div>

        <!-- Botones -->
        <div class="mt-4 d-flex gap-2">
          @if (authService.isAdmin()) {
            <button class="btn btn-warning" (click)="editProduct()">
              <i class="bi bi-pencil"></i> Editar producto
            </button>
          }
          @if (authService.isUser()) {
            <button class="btn btn-primary">
              <i class="bi bi-cart-plus"></i> Agregar al carrito
            </button>
          }
        </div>
      </div>
    </div>
  }
</div>
