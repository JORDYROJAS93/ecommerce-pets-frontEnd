<div class="container py-4">
  <button class="btn btn-success mb-3" (click)="goBack()">
    ← Volver a productos
  </button>
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Header -->
      <div class="text-center mb-4">
        @if (producto) {
        <h2 class="fw-bold text-primary mb-2">Editar Producto</h2>
        <p class="text-muted">
          Actualiza la información del producto existente
        </p>
        } @else {
        <h2 class="fw-bold text-primary mb-2">Agregar Nuevo Producto</h2>
        <p class="text-muted">
          Completa todos los campos para agregar un nuevo producto
        </p>
        }
      </div>

      <form
        [formGroup]="productForm"
        (ngSubmit)="onSubmit()"
        novalidate
        class="card border-0 shadow-sm p-4"
      >
        <div class="row">
          <!-- Columna izquierda: Información básica -->
          <div class="col-md-6">
            <!-- Nombre -->
            <div class="mb-3">
              <label for="nombre" class="form-label fw-semibold"
                >Nombre del Producto</label
              >
              <input
                type="text"
                class="form-control form-control-lg"
                id="nombre"
                formControlName="nombre"
                [class.is-invalid]="
                  productForm.get('nombre')?.invalid &&
                  productForm.get('nombre')?.touched
                "
                autocomplete="off"
                placeholder="Ingresa el nombre del producto"
              />
              @if (productForm.get('nombre')?.invalid &&
              productForm.get('nombre')?.touched) {
              <div class="invalid-feedback d-block mt-1">
                El nombre es requerido.
              </div>
              }
            </div>

            <!-- SKU -->
            <div class="mb-3">
              <label for="sku" class="form-label fw-semibold">SKU</label>
              <input
                type="text"
                class="form-control form-control-lg"
                id="sku"
                formControlName="sku"
                [class.is-invalid]="
                  productForm.get('sku')?.invalid &&
                  productForm.get('sku')?.touched
                "
                autocomplete="off"
                placeholder="Código único de identificación"
              />
              @if (productForm.get('sku')?.invalid &&
              productForm.get('sku')?.touched) {
              <div class="invalid-feedback d-block mt-1">
                El SKU es requerido.
              </div>
              }
            </div>

            <!-- Marca -->
            <div class="mb-3">
              <label for="idMarca" class="form-label fw-semibold">Marca</label>
              <select
                class="form-select form-select-lg"
                id="idMarca"
                formControlName="idMarca"
                [class.is-invalid]="
                  productForm.get('idMarca')?.invalid &&
                  productForm.get('idMarca')?.touched
                "
              >
                <option value="">Selecciona una marca</option>
                @for (marca of marcas; track marca.id) {
                <option [value]="marca.id">{{ marca.nombre }}</option>
                }
              </select>
              @if (productForm.get('idMarca')?.invalid &&
              productForm.get('idMarca')?.touched) {
              <div class="invalid-feedback d-block mt-1">
                La marca es requerida.
              </div>
              }
            </div>

            <!-- Categoría -->
            <div class="mb-3">
              <label for="idCategoria" class="form-label fw-semibold"
                >Categoría</label
              >
              <select
                class="form-select form-select-lg"
                id="idCategoria"
                formControlName="idCategoria"
                [class.is-invalid]="
                  productForm.get('idCategoria')?.invalid &&
                  productForm.get('idCategoria')?.touched
                "
              >
                <option value="">Selecciona una categoría</option>
                @for (categoria of categorias; track categoria.id) {
                <option [value]="categoria.id">{{ categoria.nombre }}</option>
                }
              </select>
              @if (productForm.get('idCategoria')?.invalid &&
              productForm.get('idCategoria')?.touched) {
              <div class="invalid-feedback d-block mt-1">
                La categoría es requerida.
              </div>
              }
            </div>

            <!-- Mascota -->
            <div class="mb-3">
              <label for="idMascota" class="form-label fw-semibold">Para</label>
              <select
                class="form-select form-select-lg"
                id="idMascota"
                formControlName="idMascota"
                [class.is-invalid]="
                  productForm.get('idMascota')?.invalid &&
                  productForm.get('idMascota')?.touched
                "
              >
                <option value="">Selecciona una mascota</option>
                @for (mascota of mascotas; track mascota.id) {
                <option [value]="mascota.id">{{ mascota.especie }}</option>
                }
              </select>
              @if (productForm.get('idMascota')?.invalid &&
              productForm.get('idMascota')?.touched) {
              <div class="invalid-feedback d-block mt-1">
                La mascota es requerida.
              </div>
              }
            </div>

            <!-- Descripción Corta -->
            <div class="mb-3">
              <label for="descripcionCorta" class="form-label fw-semibold"
                >Descripción Corta</label
              >
              <input
                type="text"
                class="form-control form-control-lg"
                id="descripcionCorta"
                formControlName="descripcionCorta"
                [class.is-invalid]="
                  productForm.get('descripcionCorta')?.invalid &&
                  productForm.get('descripcionCorta')?.touched
                "
                autocomplete="off"
                placeholder="Breve descripción del producto"
              />
              @if (productForm.get('descripcionCorta')?.invalid &&
              productForm.get('descripcionCorta')?.touched) {
              <div class="invalid-feedback d-block mt-1">
                La descripción corta es requerida.
              </div>
              }
            </div>
          </div>

          <!-- Columna derecha: Información adicional -->
          <div class="col-md-6">
            <!-- Precio y Costo -->
            <div class="row g-3 mb-3">
              <div class="col-sm-6">
                <label for="precio" class="form-label fw-semibold"
                  >Precio (S/.)</label
                >
                <div class="input-group">
                  <span class="input-group-text bg-light">S/.</span>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control form-control-lg"
                    id="precio"
                    formControlName="precio"
                    [class.is-invalid]="
                      productForm.get('precio')?.invalid &&
                      productForm.get('precio')?.touched
                    "
                    min="0"
                    placeholder="0.00"
                  />
                </div>
                @if (productForm.get('precio')?.invalid &&
                productForm.get('precio')?.touched) {
                <div class="invalid-feedback d-block mt-1">
                  @if (productForm.get('precio')?.errors?.['required']) { El
                  precio es requerido. } @if
                  (productForm.get('precio')?.errors?.['min']) { El precio debe
                  ser mayor a 0. }
                </div>
                }
              </div>

              <div class="col-sm-6">
                <label for="costo" class="form-label fw-semibold"
                  >Costo (S/.)</label
                >
                <div class="input-group">
                  <span class="input-group-text bg-light">S/.</span>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control form-control-lg"
                    id="costo"
                    formControlName="costo"
                    [class.is-invalid]="
                      productForm.get('costo')?.invalid &&
                      productForm.get('costo')?.touched
                    "
                    min="0"
                    placeholder="0.00"
                  />
                </div>
                @if (productForm.get('costo')?.invalid &&
                productForm.get('costo')?.touched) {
                <div class="invalid-feedback d-block mt-1">
                  @if (productForm.get('costo')?.errors?.['required']) { El
                  costo es requerido. } @if
                  (productForm.get('costo')?.errors?.['min']) { El costo debe
                  ser mayor a 0. }
                </div>
                }
              </div>
            </div>

            <!-- Peso -->
            <div class="row g-3 mb-3">
              <div class="col-sm-6">
                <label for="pesoGramos" class="form-label fw-semibold"
                  >Peso (gramos)</label
                >
                <div class="input-group">
                  <input
                    type="number"
                    class="form-control form-control-lg"
                    id="pesoGramos"
                    formControlName="pesoGramos"
                    [class.is-invalid]="
                      productForm.get('pesoGramos')?.invalid &&
                      productForm.get('pesoGramos')?.touched
                    "
                    min="1"
                    placeholder="0"
                  />
                  <span class="input-group-text bg-light">g</span>
                </div>
                @if (productForm.get('pesoGramos')?.invalid &&
                productForm.get('pesoGramos')?.touched) {
                <div class="invalid-feedback d-block mt-1">
                  @if (productForm.get('pesoGramos')?.errors?.['required']) { El
                  peso es requerido. } @if
                  (productForm.get('pesoGramos')?.errors?.['min']) { El peso
                  debe ser mayor a 0. }
                </div>
                }
              </div>

              <!-- Stock -->
              <div class="col-sm-6">
                <label for="stock" class="form-label fw-semibold">Stock</label>
                <input
                  type="number"
                  class="form-control form-control-lg"
                  id="stock"
                  formControlName="stock"
                  [class.is-invalid]="
                    productForm.get('stock')?.invalid &&
                    productForm.get('stock')?.touched
                  "
                  min="0"
                  placeholder="0"
                />
                @if (productForm.get('stock')?.invalid &&
                productForm.get('stock')?.touched) {
                <div class="invalid-feedback d-block mt-1">
                  El stock es requerido y debe ser mayor o igual a 0.
                </div>
                }
              </div>
            </div>
            <!-- Estado -->
            <div class="mb-4">
              <label for="estaActivo" class="form-label fw-semibold"
                >Estado</label
              >
              <select
                class="form-select form-select-lg"
                id="estaActivo"
                formControlName="estaActivo"
              >
                <option [value]="true">Activo</option>
                <option [value]="false">Inactivo</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Descripción Completa (ancho completo) -->
        <div class="mb-4">
          <label for="descripcion" class="form-label fw-semibold"
            >Descripción Completa</label
          >
          <textarea
            class="form-control form-control-lg"
            id="descripcion"
            formControlName="descripcion"
            rows="4"
            [class.is-invalid]="
              productForm.get('descripcion')?.invalid &&
              productForm.get('descripcion')?.touched
            "
            autocomplete="off"
            placeholder="Describe detalladamente el producto..."
          ></textarea>
          @if (productForm.get('descripcion')?.invalid &&
          productForm.get('descripcion')?.touched) {
          <div class="invalid-feedback d-block mt-1">
            La descripción es requerida.
          </div>
          }
        </div>

        <!-- Botones -->
        <div class="d-flex gap-3 pt-3 justify-content-end">
          <button
            type="button"
            class="btn btn-outline-secondary px-4 py-2"
            (click)="resetForm()"
            [disabled]="loading"
          >
            Limpiar
          </button>

          <button
            type="submit"
            class="btn btn-primary px-4 py-2"
            [disabled]="productForm.invalid || loading"
          >
            @if (loading) {
            <span
              class="spinner-border spinner-border-sm me-2"
              role="status"
            ></span>
            Guardando... } @else {
            {{ producto?.id ? "Actualizar Producto" : "Crear Producto" }}
            }
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
